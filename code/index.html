<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="fr">
    <head>
        <title>Bootstrap Lazer Cat</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="css/style.css" />
    </head>

    <body style="padding: 0px;">
        <div class="container-fluid">
            <div class="panel-heading">
                <div id="header">
                    <div id="menu">
                        <img src="img/menu.png" alt="MenuImage" id="menuImage">
                    </div>
                    <div class="text-center" id="titleLogo">
                        <div id="logo">
                            <img src="img/cat.png" id="logoImage" alt="LogoImage">
                        </div>
                        <div id="title">
                            <h1>Lazer Cat</h1>
                        </div>
                    </div>
                    <div class="text-center" id="chrono">
                        00:00
                    </div>
                </div>


                <div id="parameters">
                    <div class="hidden-xs" id="parties">
                        <select id="PartieList">
                            </select>
                    </div>
                    <div  class="hidden-md hidden-lg hidden-xs" id="players">
                        <select id="JoueursList">
                            </select>
                    </div>
                </div>
            </div>

            <div class="panel-body text-center" id="container">
                <div class="row">
                    <div class="col-lg-12 visible-lg" >
                        <table id="TableTotal" class="table table-striped table-bordered table-condensed">
                            <thead>
                                <tr>
                                    <th class="text-center">Rang</th>
                                    <th class="text-center">Pseudo</th>
                                    <th class="text-center">Team</th>
                                    <th class="text-center">Précision</th>
                                    <th class="text-center">Nbr Tirs</th>
                                    <th class="text-center">Tirs réussis</th>
                                    <th class="text-center">Morts</th>
                                    <th class="text-center">Ratio</th>
                                    <th class="text-center">Score</th>
                                </tr>
                            </thead>
                            <tbody id="TableTotalBody" >
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-sm-4 col-xs-12 hidden-lg hidden-xs">
                        <table id="TableTeamA" class="table table-striped table-bordered table-condensed">
                            <caption id="TableTeamACaption" class="text-center"></caption>
                            <thead>
                            <tr>
                                <th class="text-center">Rang</th>
                                <th class="text-center">Pseudo</th>
                                <th class="text-center">Précision</th>
                                <th class="text-center">Ratio</th>
                                <th class="text-center">Score</th>
                            </tr>
                            </thead>
                            <tbody id="TableTeamABody">
                            </tbody>
                        </table>
                    </div>
                    <div class="col-sm-4 visible-sm">
                        <div class="col-sm-10 col-sm-offset-2 visible-sm">
                            <table id="TableGiven" class="table table-striped table-bordered table-condensed">
                            <caption class="text-center">TIRS DONNES</caption>
                            <thead>
                            <tr>
                                <th class="text-center">Dos</th>
                                <th class="text-center">Torse</th>
                                <th class="text-center">Epaules</th>
                                <th class="text-center">Arme</th>
                                <th class="text-center">Total</th>
                            </tr>
                            </thead>
                            <tbody id="TableGivenBody">
                            </tbody>
                        </table>
                        </div>
                    </div>
                    <div class="col-sm-4 visible-sm">
                        <div class="col-sm-10 col-sm-offset-1 visible-sm">
                            <table id="TableTaken" class="table table-striped table-bordered table-condensed">
                            <caption class="text-center">TIRS RECUS</caption>
                            <thead>
                            <tr>
                                <th class="text-center">Dos</th>
                                <th class="text-center">Torse</th>
                                <th class="text-center">Epaules</th>
                                <th class="text-center">Arme</th>
                                <th class="text-center">Total</th>
                            </tr>
                            </thead>
                            <tbody id="TableTakenBody">
                            </tbody>
                        </table>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-4 col-xs-12 hidden-lg hidden-xs">
                        <table id="TableTeamB" class="table table-striped table-bordered table-condensed">
                            <caption id="TableTeamBCaption" class="text-center"></caption>
                            <thead>
                            <tr>
                                <th class="text-center">Rang</th>
                                <th class="text-center">Pseudo</th>
                                <th class="text-center">Précision</th>
                                <th class="text-center">Ratio</th>
                                <th class="text-center">Score</th>
                            </tr>
                            </thead>
                            <tbody id="TableTeamBBody">
                            </tbody>
                        </table>
                    </div>
                    <div class="col-sm-6 col-sm-offset-1 visible-sm">
                        <div class="col-sm-12 visible-sm">
                            <table id="TableScore" class="table table-striped table-bordered table-condensed">
                                <caption id="TableScoreCaption" class="text-center">DESCRIPTION DU SCORE</caption>
                                <thead>
                                <tr>
                                    <th class="text-center"></th>
                                    <th class="text-center">Dos</th>
                                    <th class="text-center">Coeff</th>
                                    <th class="text-center">Torse</th>
                                    <th class="text-center">Coeff</th>
                                    <th class="text-center">Epaules</th>
                                    <th class="text-center">Coeff</th>
                                    <th class="text-center">Arme</th>
                                    <th class="text-center">Coeff</th>
                                    <th class="text-center">Total</th>
                                </tr>
                                </thead>
                                <tbody id="TableScoreBody">
                                </tbody>
                            </table>
                        </div>
                        <divtitle class="col-sm-12 visible-sm" id="Score">
                        </divtitle>
                        <divtitle class="col-sm-12 visible-sm" id="Rang">
                        </divtitle>
                    </div>
                </div>

                <div class="row" id="recherche">
                    <div>
                        <input class="col-xs-4 col-xs-offset-3 visible-xs" type="text" id="textInput" value=""/>
                    </div>
                    <div>
                        <input type="button" class="col-xs-3 visible-xs" value="Rechercher" id="buttonInput" onclick="setPlayerintput()"/>
                    </div>
                </div>
                <div class="row" id="infos">
                    <divtitle class="col-xs-4 col-xs-offset-6 visible-xs" id="Score2">
                        SCORE :
                    </divtitle>
                    <divtitle class="col-xs-4 visible-xs" id="Rang2">
                        RANG :
                    </divtitle>
                </div>

                <div class="col-xs-10">
                    <div id="erreurInput"></div>
                </div>

                <div class="row visible-xs" id="chart" style="position: relative;">
                    <div>
                        <div class="col-xs-5" style="float: left;">
                            <canvas id="doughnutEpaules"/>
                        </div>
                        <div class="col-xs-5" style="float: right;">
                            <canvas id="doughnutArme"/>
                        </div>
                    </div>

                    <div class="col-xs-8 col-xs-offset-3" id="man" >
                        <img class="col-xs-12" src="img/man.png" id="manImage" alt="ManImage">
                    </div>
                    <div>
                        <div class="col-xs-5" style="float: left;">
                            <canvas id="doughnutDos"/>
                        </div>
                        <div class="col-xs-1" style="float: right;">
                        </div>
                        <div class="col-xs-5" style="float: right;">
                            <canvas id="doughnutTorse"/>
                        </div>

                    </div>
                </div>
            </div>
        </div>





        <script src="chart/js/Chart.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <script src="js/Player.js"></script>
        <script src="js/Team.js"></script>
        <script src="js/Game.js"></script>
        <script>

            function color(elmt, name) {
                switch(name) {
                    case "ROUGE" :
                        elmt.setAttribute("style", "color:#E74C3C");
                        break;
                    case "BLEU" :
                        elmt.setAttribute("style", "color:#3498DB");
                        break;
                    case "JAUNE" :
                        elmt.setAttribute("style", "color:#F1C40F");
                        break;
                    default :
                        elmt.setAttribute("style", "color:#000000");
                        break;
                }
            }

            function addLignesToTable(elmt, players, type, isColored)
            {
                for (let i = 0; i < players.length; i++) {
                    var tr = document.createElement('tr');
                    elmt.appendChild(tr);

                    let infos = [];
                    switch (type) {
                        case "TEAM" :
                            infos = players[i].getInformationForTeam();
                            break;
                        case "ALL" :
                            infos = players[i].getInformationForAll();
                            break;
                        case "DETAIL" :
                            infos = players[i].getInformationForDetails();
                            break;
                        case "SCORES_TAKEN" :
                            infos = players[currentIdPlayer].getInformationForScoresTaken();
                            drawLigne(infos, tr, players[currentIdPlayer], isColored);
                            return;
                            break;
                        case "SCORES_GIVEN" :
                            infos = players[currentIdPlayer].getInformationForScoresGiven();
                            drawLigne(infos, tr, players[currentIdPlayer], isColored);
                            return;
                            break;
                        default :
                            infos = players[i].getInformationForTeam();
                            break;
                    }

                    drawLigne(infos, tr, players[i], isColored);
                }
            }

            function drawLigne(infos, tr, player, isColored) {
                for(let j = 0; j < infos.length; j++) {
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    var tdText = document.createTextNode(infos[j]);
                    td.appendChild(tdText);
                    if(isColored && j == 1) {color(td, player.teamName);}
                }
            }

            function draw(game) {
                let initialA;
                let initialB;

                if (currentIdTeam != game.teamA.id) {
                    initialA = 'A';
                    initialB = 'B';
                } else {
                    initialB = 'A';
                    initialA = 'B';
                }
                while (document.getElementById('TableTotalBody').rows.length > 0) {document.getElementById('TableTotalBody').deleteRow(0);}
                addLignesToTable(document.getElementById('TableTotalBody'), game.orderPlayer(), "ALL", true);

                while (document.getElementById('TableTeam' + initialA + 'Body').rows.length > 0) {document.getElementById('TableTeam' + initialA + 'Body').deleteRow(0);}
                addLignesToTable(document.getElementById('TableTeam' + initialA + 'Body'), game.teamA.orderTeam(), "TEAM", true);
                document.getElementById('TableTeam' + initialA + 'Caption').textContent = ("EQUIPE " + game.teamA.name);
                color(document.getElementById('TableTeam' + initialA + 'Caption'), game.teamA.name);

                while (document.getElementById('TableTeam' + initialB + 'Body').rows.length > 0) {document.getElementById('TableTeam' + initialB + 'Body').deleteRow(0);}
                addLignesToTable(document.getElementById('TableTeam' + initialB + 'Body'), game.teamB.orderTeam(), "TEAM", true);
                document.getElementById('TableTeam' + initialB + 'Caption').textContent = ("EQUIPE " + game.teamB.name);
                color(document.getElementById('TableTeam' + initialB + 'Caption'), game.teamB.name);

                while (document.getElementById('TableGivenBody').rows.length > 0) {document.getElementById('TableGivenBody').deleteRow(0);}
                addLignesToTable(document.getElementById('TableGivenBody'), game.teamA.orderTeam(), "DETAIL", false);

                while (document.getElementById('TableTakenBody').rows.length > 0) {document.getElementById('TableTakenBody').deleteRow(0);}
                addLignesToTable(document.getElementById('TableTakenBody'), game.teamB.orderTeam(), "DETAIL", false);

                let currentTeam;
                if (currentIdTeam == game.teamA.id)
                    currentTeam = game.teamA;
                else
                    currentTeam = game.teamB;
                while (document.getElementById('TableScoreBody').rows.length > 0) {document.getElementById('TableScoreBody').deleteRow(0);}
                addLignesToTable(document.getElementById('TableScoreBody'), currentTeam.orderTeamById(), "SCORES_TAKEN", false);
                addLignesToTable(document.getElementById('TableScoreBody'), currentTeam.orderTeamById(), "SCORES_GIVEN", false);

                document.getElementById('Score').textContent = ("SCORE : " + currentTeam.orderTeamById()[currentIdPlayer].score);
                color(document.getElementById('Score'), currentTeam.name);

                document.getElementById('Rang').textContent = ("RANG : " + currentTeam.orderTeamById()[currentIdPlayer].rang);
                color(document.getElementById('Rang'), currentTeam.name);
            }

            function loadParties() {
                while (document.getElementById('PartieList').getElementsByTagName('option').length > 0) {
                    document.getElementById('PartieList').removeChild(document.getElementById('PartieList').getElementsByTagName('option')[0]);
                }

                for(let i = 0; i < game.length; i++) {
                    var option = document.createElement('option');
                    option.setAttribute("value", (i+1));
                    option.appendChild(document.createTextNode("PARTIE " + (i + 1)));
                    document.getElementById('PartieList').appendChild(option);
                }
                document.getElementById('PartieList').selectedIndex = 0;

            }

            function loadPlayers() {
                while (document.getElementById('JoueursList').getElementsByTagName('option').length > 0) {
                    document.getElementById('JoueursList').removeChild(document.getElementById('JoueursList').getElementsByTagName('option')[0]);
                }

                for (let i = 0; i < game[currentIdGame].teamA.orderTeamById().length; i++) {
                    var option = document.createElement('option');
                    option.setAttribute("value", game[currentIdGame].teamA.orderTeamById()[i].playerId);
                    color(option, game[currentIdGame].teamA.orderTeamById()[i].teamName);
                    option.appendChild(document.createTextNode("Joueur " + game[currentIdGame].teamA.orderTeamById()[i].pseudo));
                    document.getElementById('JoueursList').appendChild(option);
                }
                for (let i = 0; i < game[currentIdGame].teamB.orderTeamById().length; i++) {
                    var option = document.createElement('option');
                    option.setAttribute("value", game[currentIdGame].teamB.orderTeamById()[i].playerId);
                    color(option, game[currentIdGame].teamB.orderTeamById()[i].teamName);
                    option.appendChild(document.createTextNode("Joueur " + game[currentIdGame].teamB.orderTeamById()[i].pseudo));
                    document.getElementById('JoueursList').appendChild(option);
                }
                document.getElementById('JoueursList').selectedIndex = 0;
            }

            function scrollWin(compteur) {

                if(window.innerWidth < 1200) {
                    //if (compteur != 0)
                    //window.scrollTo(0, 0);
                    compteur = 0;
                    var method = function () {
                        scrollWin(compteur);
                    };
                    setTimeout(method, 2000);
                } else {
                    window.scrollTo(0, compteur);
                }

                if(compteur == 0) {
                    compteur++;
                    var method = function() {scrollWin(compteur);};
                    setTimeout(method, 2000);
                }
                else if(compteur + window.innerHeight  < document.body.scrollHeight) {
                    compteur++;
                    var method = function() {scrollWin(compteur);};
                    setTimeout(method, 25);
                } else {
                    compteur = 0;
                    var method = function() {scrollWin(compteur);};
                    setTimeout(method, 2000);
                }
            }

            function drawChart(rate, doughnutName) {
                var doughnutData = [
                    {
                        value: rate,
                        color: "#F7464A",
                        highlight: "#FF5A5E",
                        label: "Reçu"
                    },
                    {
                        value: 100 - rate,
                        color: "#46BFBD",
                        highlight: "#5AD3D1",
                        label: "Donnée"
                    }
                ];
                var doughnutOptions = {responsive: true}
                var doughnut = document.getElementById(doughnutName).getContext("2d");
                new Chart(doughnut).Doughnut(doughnutData, doughnutOptions);
            }

            function setPlayerintput() {
                let x = document.getElementById("textInput").value;
                let id = -1;

                let players = game[game.length-1].orderPlayer();
                for(let i = 0; i < players.length; i++) {
                    if(players[i].pseudo == x ) {
                        id = i;
                        break;
                    }
                }

                if(id == -1) {
                    document.getElementById('erreurInput').textContent = ("Erreur : pseudo inconnu !");
                } else {
                    drawChart(players[id].getRate (0, true), "doughnutDos");
                    drawChart(players[id].getRate (1, true), "doughnutTorse");
                    drawChart(players[id].getRate (2, true), "doughnutEpaules");
                    drawChart(players[id].getRate (3, true), "doughnutArme");

                    document.getElementById('erreurInput').textContent = ("");
                    document.getElementById('Score2').textContent = ("SCORE : " + players[id].score);
                    document.getElementById('Rang2').textContent = ("RANG : " + players[id].rang);
                }
            }

            let game = [];
            let currentIdGame = 0;
            let currentIdTeam = 0;
            let currentIdPlayer = 0;

            game.push(new Game(0, new Team(0, "ROUGE"), new Team(1, "BLEU"), 0, 0));
            game[0].play = false;
            game.push(new Game(1, new Team(1, "BLEU"), new Team(2, "JAUNE"), 0, 0));
            game[1].play = false;
            game.push(new Game(2, new Team(2, "JAUNE"), new Team(0, "ROUGE"), 0, 20));

            draw(game[currentIdGame]);
            loadParties();
            loadPlayers();

            var partielist = document.getElementById('PartieList');
            partielist.addEventListener('change', function() {
                game[currentIdGame].play = false;
                currentIdGame = partielist.selectedIndex;
                game[currentIdGame].play = true;
                currentIdTeam = 0;
                currentIdPlayer = 0;
                draw(game[currentIdGame]);
                loadPlayers();
                game[currentIdGame].playChrono(chr);
            });

            var joueurslist = document.getElementById('JoueursList');
            joueurslist.addEventListener('change', function () {
                if (joueurslist.selectedIndex < 10) {
                    currentIdTeam = game[currentIdGame].teamA.id;
                    currentIdPlayer = joueurslist.selectedIndex;
                    document.getElementById("textInput").value = game[currentIdGame].teamA.listPlayers[currentIdPlayer].pseudo;
                } else {
                    currentIdTeam = game[currentIdGame].teamB.id;
                    currentIdPlayer = joueurslist.selectedIndex % 10;
                    document.getElementById("textInput").value = game[currentIdGame].teamB.listPlayers[currentIdPlayer].pseudo;
                }

                setPlayerintput();

                draw(game[currentIdGame]);
            });

            let chr = document.getElementById('chrono');
            game[currentIdGame].playChrono(chr);


            var method = function() {scrollWin(0);};
            setTimeout(method, 0);
        </script>

    </body>
</html>